<!DOCTYPE html>
<html>
<head>
    <title>LinkedIn Automation Dashboard</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f7f7f7; }
        h1 { text-align: center; }
        table {
            border-collapse: collapse;
            width: 100%;
            margin-top: 20px;
            background-color: #fff;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        th, td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
        }
        th {
            background-color: #fafafa;
            font-weight: bold;
        }
        tr:nth-child(even) { background-color: #f9f9f9; }
        .status-success { color: #2e7d32; font-weight: bold; }
        .status-failure { color: #c62828; font-weight: bold; }
        a { color: #1976d2; text-decoration: none; }
        a:hover { text-decoration: underline; }
        #error { text-align: center; color: #c62828; font-weight: bold; margin-top: 40px; }
    </style>
</head>
<body>
    <h1>LinkedIn Job Applications</h1>
    <div id="error" style="display:none;">No application history available.</div>
    <table id="applicationsTable" style="display:none;">
        <thead>
            <tr>
                <th>#</th>
                <th>Timestamp (UTC)</th>
                <th>Job Title</th>
                <th>Company</th>
                <th>Status</th>
                <th>Job Link</th>
                <th>Resume Path</th>
                <th>Error Message</th>
            </tr>
        </thead>
        <tbody id="applicationsBody"></tbody>
    </table>

    <script>
        function createRow(entry, index) {
            const row = document.createElement('tr');

            const idxCell = document.createElement('td');
            idxCell.textContent = index + 1;
            row.appendChild(idxCell);

            const timestampCell = document.createElement('td');
            timestampCell.textContent = entry.timestamp || '';
            row.appendChild(timestampCell);

            const titleCell = document.createElement('td');
            titleCell.textContent = entry.job_title || '';
            row.appendChild(titleCell);

            const companyCell = document.createElement('td');
            companyCell.textContent = entry.company || '';
            row.appendChild(companyCell);

            const statusCell = document.createElement('td');
            statusCell.textContent = entry.status === 'failure' ? 'Failed' : 'Success';
            statusCell.className = entry.status === 'failure' ? 'status-failure' : 'status-success';
            row.appendChild(statusCell);

            const linkCell = document.createElement('td');
            if (entry.job_url) {
                const link = document.createElement('a');
                link.href = entry.job_url;
                link.textContent = 'View Job';
                link.target = '_blank';
                linkCell.appendChild(link);
            } else {
                linkCell.textContent = 'N/A';
            }
            row.appendChild(linkCell);

            const resumeCell = document.createElement('td');
            resumeCell.textContent = entry.resume_path || '';
            row.appendChild(resumeCell);

            const errorCell = document.createElement('td');
            errorCell.textContent = entry.error_message || '';
            row.appendChild(errorCell);

            return row;
        }

        fetch('/applications')
            .then(response => response.json())
            .then(data => {
                if (!Array.isArray(data) || data.length === 0) {
                    document.getElementById('error').style.display = 'block';
                    return;
                }
                const tbody = document.getElementById('applicationsBody');
                data.forEach((entry, index) => {
                    tbody.appendChild(createRow(entry, index));
                });
                document.getElementById('applicationsTable').style.display = 'table';
            })
            .catch(() => {
                document.getElementById('error').style.display = 'block';
            });
    </script>
</body>
</html>
